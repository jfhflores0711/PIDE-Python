<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resultado SUNARP</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>


</head>
<body class="container py-5">
    <h1 class="mb-4">Resultado de la consulta SUNARP</h1>

    {% if tipo == "placa" %}
        <h3 class="mb-4">üöó Consulta por Placa Vehicular</h3>
        {% if data %}
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <table class="table table-bordered table-hover align-middle mb-0">
                        <tbody>
                            <tr><th scope="row">Placa</th><td>{{ data.placa }}</td></tr>
                            <tr><th scope="row">Marca</th><td>{{ data.marca }}</td></tr>
                            <tr><th scope="row">Modelo</th><td>{{ data.modelo }}</td></tr>
                            <tr><th scope="row">Color</th><td>{{ data.color }}</td></tr>
                            <tr><th scope="row">Carrocer√≠a</th><td>{{ data.carroceria }}</td></tr>
                            <tr><th scope="row">Estado</th><td>{{ data.estado }}</td></tr>
                            <tr><th scope="row">A√±o de Fabricaci√≥n</th><td>{{ data.anoFabricacion }}</td></tr>
                            <tr><th scope="row">VIN</th><td>{{ data.vin }}</td></tr>
                            <tr><th scope="row">N¬∞ Motor</th><td>{{ data.nro_motor }}</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <h5>üë§ Propietarios</h5>
            {% if data.propietarios %}
                <ul class="list-group">
                    {% for propietario in data.propietarios %}
                        <li class="list-group-item">{{ propietario }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">No se registraron propietarios.</p>
            {% endif %}
        {% else %}
            <div class="alert alert-warning">No se encontr√≥ informaci√≥n para esta placa.</div>
        {% endif %}

    {% elif tipo == "oficinas" %}
        <h3 class="mb-4">üè¢ Listado de Oficinas Registrales SUNARP</h3>
        {% if data and data.oficinas %}
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <table id="tablaOficinas" class="table table-striped table-hover align-middle">
                        <thead>
                            <tr>
                                <th>Oficina</th>
                                <th>Nombre</th>
                                <th>Zona</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for oficina in data.oficinas %}
                            <tr>
                                <td>{{ oficina.codigo or "‚Äî" }}</td>
                                <td>{{ oficina.nombre or "‚Äî" }}</td>
                                <td>{{ oficina.zona or "‚Äî" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <script>
                $(document).ready(function () {
                    $('#tablaOficinas').DataTable({
                        "pageLength": 10,
                        "lengthMenu": [10, 25, 50],
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"
                        }
                    });
                });
            </script>
        {% else %}
            <div class="alert alert-warning">
                ‚ö†Ô∏è No se encontraron oficinas en SUNARP.
            </div>
        {% endif %}
    



    {% elif tipo == "pj" %}
    <h3 class="mb-4">üè¢ Consulta Persona Jur√≠dica</h3>
    {% if data %}
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <table class="table table-striped table-hover align-middle mb-0">
                    <caption class="text-muted">Informaci√≥n obtenida de SUNARP</caption>
                    <tbody>
                        <tr>
                            <th scope="row">Denominaci√≥n</th>
                            <td>{{ data.denominacion or "‚Äî" }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Tipo</th>
                            <td>{{ data.tipo or "‚Äî" }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Zona Registral</th>
                            <td>{{ data.zona or "‚Äî" }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Oficina Registral</th>
                            <td>{{ data.oficina or "‚Äî" }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Partida</th>
                            <td>{{ data.partida or "‚Äî" }}</td>
                        </tr>
                        {% if data.ficha %}
                        <tr>
                            <th scope="row">Ficha</th>
                            <td>{{ data.ficha }}</td>
                        </tr>
                        {% endif %}
                        {% if data.tomo %}
                        <tr>
                            <th scope="row">Tomo</th>
                            <td>{{ data.tomo }}</td>
                        </tr>
                        {% endif %}
                        {% if data.folio %}
                        <tr>
                            <th scope="row">Folio</th>
                            <td>{{ data.folio }}</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    {% else %}
        <div class="alert alert-warning">
            ‚ö†Ô∏è No se encontr√≥ informaci√≥n para esta persona jur√≠dica en SUNARP.
        </div>
    {% endif %}


    {% elif tipo == "titularidad" %}
    <h3 class="mb-4">üè† Consulta de Titularidad</h3>
    {% if data %}
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <table id="tablaTitularidad" class="table table-striped table-hover align-middle">
                    <thead>
                        <tr>
                            <th>Registro</th>
                            <th>Libro</th>
                            <th>Participante</th>
                            <th>Documento</th>
                            <th>Partida</th>
                            <th>Placa</th>
                            <th>Estado</th>
                            <th>Zona</th>
                            <th>Oficina</th>
                            <th>Direcci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for t in data %}
                        <tr class="{% if t.estado and 'ACTIVA' in t.estado.upper() %}table-success{% elif t.estado and 'CANCELADA' in t.estado.upper() %}table-danger{% else %}table-secondary{% endif %}">
                            <td>{{ t.registro or "‚Äî" }}</td>
                            <td>{{ t.libro or "‚Äî" }}</td>
                            <td>
                                {% if t.razonSocial %}
                                    {{ t.razonSocial }}
                                {% else %}
                                    {{ (t.apPaterno ~ " " ~ t.apMaterno ~ " " ~ t.nombre)|trim }}
                                {% endif %}
                            </td>
                            <td>{{ t.tipoDocumento }} {{ t.numeroDocumento }}</td>
                            <td>{{ t.numeroPartida or "‚Äî" }}</td>
                            <td>{{ t.numeroPlaca or "‚Äî" }}</td>
                            <td><strong>{{ t.estado or "‚Äî" }}</strong></td>
                            <td>{{ t.zona or "‚Äî" }}</td>
                            <td>{{ t.oficina or "‚Äî" }}</td>
                            <td>{{ t.direccion or "‚Äî" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <script>
            $(document).ready(function() {
                $('#tablaTitularidad').DataTable({
                    "pageLength": 5,   // üëà cantidad de registros por p√°gina
                    "lengthMenu": [5, 10, 25, 50],
                    "language": {
                        "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"
                    }
                });
            });
        </script>
    {% else %}
        <div class="alert alert-warning">
            ‚ö†Ô∏è No se encontraron bienes registrados para este participante en SUNARP.
        </div>
    {% endif %}


    {% else %}
        <p>No se pudo determinar el tipo de consulta.</p>
    {% endif %}

    <div class="mt-4 d-flex gap-3">
        <a href="/sunarp" class="btn btn-secondary">Nueva consulta</a>
        <a href="/" class="btn btn-dark">Volver al men√∫ principal</a>
    </div>
</body>
</html>